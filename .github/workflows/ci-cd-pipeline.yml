name: Python CI/CD Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    name: Run Test Suite
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10']  # Test multiple Python versions!

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install pytest
      run: pip install pytest

    - name: Run tests with pytest
      run: pytest -v test_main.py

    - name: Test coverage
      run: |
        pip install coverage
        coverage run -m pytest test_main.py
        coverage report

  security-scan:
    name: Security Scan
    runs-on: ubuntu-latest
    needs: test  # Wait for tests to pass first
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Basic security check
      run: |
        echo "üîí Running security checks..."
        # Check for hardcoded secrets (basic version)
        if grep -r "password\|secret\|key" . --include="*.py"; then
          echo "‚ö†Ô∏è  Warning: Possible hardcoded secrets found"
        else
          echo "‚úÖ No obvious secrets found"
        fi

  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: [test, security-scan]  # Wait for BOTH jobs
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Deployment simulation
      run: |
        echo "üöÄ DEPLOYING TO PRODUCTION!"
        echo "Application: my-first-ci-cd"
        echo "Version: $GITHUB_SHA"
        echo "Deployed by: $GITHUB_ACTOR"
        echo "Timestamp: $(date)"
        echo "‚úÖ All quality checks passed!"
        echo "üìä Test coverage: 100%"
        echo "üîí Security scan: Clean"
